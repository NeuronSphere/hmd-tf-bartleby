version: "3.2"
services:
  transform_test:
    image: ghcr.io/hmdlabs/hmd-tf-bartleby:test
    container_name: hmd-tf-bartleby
    environment:
      HMD_INSTANCE_NAME: hmd-tf-bartleby-test
      HMD_REPO_NAME: hmd-tf-bartleby
      HMD_REPO_VERSION: test
      HMD_ENVIRONMENT: kmw
      HMD_REGION: reg1
      HMD_CUSTOMER_CODE: hmd
      HMD_DID: aaa
      TRANSFORM_INSTANCE_CONTEXT: $TRANSFORM_INSTANCE_CONTEXT
      NID_CONTEXT: default
      HMD_DOC_REPO_NAME: $HMD_DOC_REPO_NAME
      HMD_DOC_REPO_VERSION: $HMD_DOC_REPO_VERSION
      AUTODOC: $AUTODOC
      PIP_USERNAME: /run/secrets/pip_username
      PIP_PASSWORD: /run/secrets/pip_password
    volumes:
      - type: bind
        source: "${REPO_FOLDER}/docs"
        target: "/hmd_transform/input/$1"
      - type: bind
        source: "${REPO_FOLDER}/target/bartleby"
        target: "/hmd_transform/output/$1"
      - type: bind
        source: "${REPO_FOLDER}/src/python"
        target: "/code/src/python/$1"
      - type: bind
        source: "$[HMD_REPO_HOME}/hmd-tf-bartleby/target/gather"
        target: /hmd_transform/output/gather
      - type: bind
        source: "${HMD_REPO_HOME}/hmd-ms-transform/docs"
        target: /hmd_transform/input/hmd-ms-transform
      - type: bind
        source: "${HMD_REPO_HOME}/hmd-ms-transform/target/bartleby"
        target: /hmd_transform/output/hmd-ms-transform
      - type: bind
        source: "${HMD_REPO_HOME}/hmd-ms-transform/src/python"
        target: /code/src/python/hmd-ms-transform
    secrets:
      - pip_username
      - pip_password
secrets:
  pip_username:
    file: "${HMD_BARTLEBY_HOME}/secrets/pip_user.txt"
  pip_password:
    file: "${HMD_BARTLEBY_HOME}/secrets/pip_pwd.txt"